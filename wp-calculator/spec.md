# Спецификация: Визуальный калькулятор WP

**Feature**: Визуальный калькулятор для вычисления слабейших предусловий (weakest precondition).

## 1. Обзор и контекст

Создается инструмент, который позволяет пользователям вводить простую программу и постусловие, а затем визуализирует пошаговый процесс вычисления слабейшего предусловия (wp) по правилам Дейкстры. Это поможет в изучении и понимании формальной верификации программ.

## 2. Пользовательские сценарии

- **UC-1: Вычисление для присваивания.** Пользователь вводит оператор присваивания (например, `x := 2*x + 5`) и постусловие (например, `x > 15`). Система показывает результат подстановки и итоговое предусловие (`x > 5`).
- **UC-2: Вычисление для последовательности.** Пользователь вводит последовательность операторов (которые internally передаются в виде стека). Система рекурсивно "протягивает" постусловие с конца к началу.
- **UC-3: Вычисление для ветвления.** Пользователь вводит оператор `if` (например, `if (x > y) then max := x else max := y`) и постусловие (`max > 100`). Система вычисляет предусловия для обеих веток и объединяет их в дизъюнкцию.
- **UC-4: Просмотр триады Хоара.** После вычисления слабейшего предусловия `P`, система отображает итоговую триаду Хоара `{P} S {R}`.
- **UC-5: Трассировка вычислений.** Пользователь может просмотреть пошаговый лог (трейс) процесса вычисления слабейшего предусловия.

## 3. Функциональные требования

- **FR-1:** Интерфейс для ввода однострочной или многострочной программы `S`.
- **FR-2:** Интерфейс для ввода постусловия `R`.
- **FR-3:** Кнопка для запуска вычисления `wp(S, R)`.
- **FR-4:** Область для отображения пошагового процесса вычисления. Каждый шаг должен быть четко отделен и понятен.
- **FR-5:** Отображение финального слабейшего предусловия.
- **FR-6:** Отображение итоговой триады Хоара.
- **FR-7:** Поддержка следующих конструкций:
    - Присваивание (`переменная := выражение`)
    - Последовательность операторов (разделенных `;`)
    - Ветвление (`if условие then S1 else S2`)
- **FR-8:** Упрощение финального слабейшего предусловия до краткой математической записи (например, `(2*x + 5) > 15` преобразуется в `x > 5`).
- **FR-9:** **[Новое]** Валидация вводимых операторов `if` и `assignment` на соответствие формату.
- **FR-10:** **[Новое]** Ведение и отображение пошагового лога (трейса) вычислений.

## 4. Нефункциональные требования

- **NFR-1:** **Интуитивность.** Интерфейс должен быть простым и понятным для студентов, изучающих формальные методы.
- **NFR-2:** **Отзывчивость.** Преобразования должны отображаться мгновенно.
- **NFR-3:** **[Уточнение]** Логика для последовательности операторов реализована и принимает стек присваиваний. Пример `y := x + 1; x := y * 2` с постусловием `x > 10` является корректным для демонстрации.

## 5. Допущения

- **A-1:** Выражения используют стандартный инфиксный синтаксис.
- **A-2:** Переменные имеют целочисленный тип.
- **A-3:** Не рассматривается обработка ошибок парсинга или некорректного ввода (на первом этапе).

## 6. Вне рамок (Out of Scope)

- Циклы (`while`).
- Процедуры и функции.
- Сложные типы данных (массивы, структуры).