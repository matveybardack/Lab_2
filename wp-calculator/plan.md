# План реализации: Визуальный калькулятор WP (v2.0 - на основе кода)

**Feature**: [spec.md](wp-calculator/spec.md)

## 1. Технический контекст и Архитектура

- **Язык**: C#
- **Платформа**: .NET Framework
- **UI Framework**: WPF
- **Архитектура**: 3-слойная (View -> Service -> Business Logic)
  - `WpfAppWPCalculator`: Слой представления (View), включающий `MainWindow.xaml` и `MainWindow.xaml.cs`. Выполняет первичную валидацию и делегирует вычисления сервисному слою.
  - `ClassLibraryWPCalculator`: Слой бизнес-логики, реализованный как библиотека классов.
  - `TestProjectWPCalculator1`: Проект с модульными тестами (xUnit).

## 2. Структура и компоненты `ClassLibraryWPCalculator`

- **`WPCalculatorService`**: Реализация `IWPCalculatorService`. Является фасадом для бизнес-логики. Отвечает за очистку трейса и вызов `WPCalculator`.
- **`WPCalculator`**: Ядро, реализующее логику вычисления слабейшего предусловия для операторов `assignment`, `if-then-else` и `sequence`.
- **`ExpressionParser`**: Реализация `IExpressionParser`. Выполняет синтаксическую проверку и валидацию вводимых пользователем операторов.
- **`InequalitySimplifier`**: Реализация `ISimplificateInequality`. Отвечает за решение и упрощение линейных неравенств.
- **`WpTrace`**: Статический класс для сбора и предоставления доступа к пошаговому логу вычислений.
- **`Interfaces/`**: Директория, содержащая контракты для сервиса, парсера и упростителя.

## 3. Поток данных

1.  **UI (`MainWindow`)**: Пользователь выбирает сценарий и тип операции. Вводит оператор.
2.  **UI (`BtnCalculate_Click`)**: Введенные данные валидируются с помощью `ExpressionParser`.
3.  **Service (`WPCalculatorService`)**: UI вызывает соответствующий метод сервиса (например, `CalculateForAssignment`). Сервис очищает `WpTrace` и вызывает ядро `WPCalculator`.
4.  **Core (`WPCalculator`)**: Выполняет вычисление `wp`. В процессе вызывает `InequalitySimplifier` для упрощения промежуточных и финального результатов. Каждый значимый шаг логируется в `WpTrace`.
5.  **UI (`MainWindow`)**: Получает итоговое предусловие от сервиса и обновляет `tbWpResult`. Запрашивает у `WpTrace` полный лог и отображает его в `lbTrace`.

## 4. Задачи

*Так как план описывает уже существующую систему, этот раздел служит для документирования, а не для планирования новой работы.*