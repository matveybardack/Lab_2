# План реализации: Визуальный калькулятор WP

**Feature**: [spec.md](wp-calculator/spec.md)

## 1. Технический контекст

- **Язык**: C#
- **Платформа**: .NET Framework 4.7.2
- **UI Framework**: WPF
- **Архитектура**: 4-слойная (UI -> Service Layer -> Business Logic -> Data (in-memory))
  - `WpfAppWPCalculator`: Пользовательский интерфейс.
  - `ClassLibraryWPCalculator`: Сервисный слой и основная бизнес-логика.
  - `TestProjectWPCalculator`: Модульные тесты для библиотеки классов.
- **Основной фокус**: `ClassLibraryWPCalculator`. Пользовательский интерфейс имеет низкий приоритет.

## 2. Проверка соответствия конституции

*Предполагается, что конституции нет, поэтому этот раздел пропускается.*

## 3. Фаза 0: Исследование (Research)

На данном этапе нет неясностей, требующих исследования. Технологический стек ясен.

## 4. Фаза 1: Дизайн и контракты

### 4.1. Модель данных (`data-model.md`)

Модель данных будет простой и в основном состоять из строковых представлений выражений и предикатов.

- **ProgramStatement**: Абстракция для операторов (`x := e`, `if B then S1 else S2`, `S1; S2`).
- **Predicate**: Представление логических условий (постусловие `R` и промежуточные предусловия).

### 4.2. Структура файлов и классов

- **`ClassLibraryWPCalculator/`**
  - **`IWPCalculatorService.cs`**: Интерфейс сервисного слоя.
    - `string CalculateWeakestPrecondition(string statement, string postcondition)`: Метод для вызова логики из UI.
  - **`WPCalculatorService.cs`**: Реализация сервиса. Инкапсулирует вызовы к парсеру и калькулятору.
  - **`ExpressionParser.cs`**: Класс для парсинга строковых представлений выражений и условий.
  - **`WPCalculator.cs`**: Основной класс для вычисления слабейшего предусловия (внутренняя логика).
- **`WpfAppWPCalculator/`**
  - **`MainWindow.xaml` / `MainWindow.xaml.cs`**: Основное и единственное окно приложения.
  - **`MainViewModel.cs`**: ViewModel для связи UI с сервисным слоем (`IWPCalculatorService`).
- **`TestProjectWPCalculator/`**
  - **`WPCalculatorTests.cs`**: Набор тестов, проверяющих корректность вычислений `wp` для всех трех сценариев.

## 5. Задачи (Предварительно)

1.  **Настройка проекта**: Создать структуру проектов (`ClassLibraryWPCalculator`, `WpfAppWPCalculator`, `TestProjectWPCalculator`) в Visual Studio.
2.  **Реализация `WPCalculator`**: Написать логику вычисления `wp` для присваивания.
3.  **Тестирование `WPCalculator`**: Написать юнит-тесты для сценария с присваиванием.
4.  **Реализация `WPCalculator`**: Добавить логику для последовательности операторов.
5.  **Тестирование `WPCalculator`**: Добавить тесты для последовательности.
6.  **Реализация `WPCalculator`**: Добавить логику для ветвления `if`.
7.  **Тестирование `WPCalculator`**: Добавить тесты для `if`.
8.  **Реализация парсера**: Начать базовую реализацию `ExpressionParser`.
9.  **Интеграция с UI**: Связать базовый UI с `WPCalculator`.

План создан. Следующий шаг - генерация детальных задач с помощью `/speckit.tasks`.